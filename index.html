<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'/>
    <title>voz3D</title>
    <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
    <link rel="shortcut icon" href="favicon.ico"/>
    <link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:200" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
<div class="control">
    <nav style="visibility: hidden;">
        <ul>
            <li id="acciones"><a class="selected" href="#">Atencion</a>
                <ul>
                    <li><a href="#">Acercame</a></li>
                    <li><a href="#">Actividad</a></li>
                    <li><a href="#">Amigos/Companeros</a></li>
                    <li><a href="#">Asistencia</a></li>
                    <li><a href="#">Atencion</a></li>
                    <li><a href="#">Ba&ntilde;o</a></li>
                    <li><a href="#">Bien</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <div id="speaker">
        <button class="fab" onmousedown="startSpeak(event)" onmouseup="stopSpeak(event)">
            <i class="material-icons">mic</i>
        </button>
    </div>
    <p id="info_upgrade">Web Speech API is not supported by this browser.
        Upgrade to <a href="//www.google.com/chrome">Chrome</a>
        version 25 or later.</p>


</div>
<div class="search-container">
    <div class="search-box">
        <div>
            <input type="text" id="input-text" class="search-input"
                   placeholder="Buscar en el diccionario"
                   autofocus list="words">
            <i id="input_img" class="material-icons">search</i>
            <datalist id="words">
                <option value="Acercame">
                <option value="Actividad">
                <option value="Amigos/Companeros">
                <option value="Asistencia">
                <option value="Atencion">
                <option value="Ba&ntilde;o">
                <option value="Bien">
            </datalist>
        </div>
    </div>
    <div id="speechMessage2">
        <span><i id="icon-result-speech" class="material-icons">volume_up</i></span>
        <p id="message">
        </p>
    </div>
</div>
<div id='container'></div>
<script src='js/libs/three.min.js'></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="js/main.js"></script>

<script type="text/javascript">
  let animations = {
    Acercarme: 'hello',
    Actividad: 'run',
    Amigos: 'walk',
    Asistencia: 'idle',
    Atencion: 'idle',
    Bano: 'idle',
    Bien: 'idle'
  }

  document.getElementById("icon-result-speech").style.visibility = 'hidden'


  function capitalizeFirstLetter (string) {
    return string.charAt(0).toUpperCase() + string.slice(1)
  }

  let dropdownAcciones = document.getElementById('acciones')
  dropdownAcciones.addEventListener('click', function (e) {
    e = e || window.event
    let target = e.target || e.srcElement
    dropdownAcciones.getElementsByClassName('selected')[0].innerText = target.innerText

    // three snippet code
    // stackAnimations.push(animations[target.innerText])
    // fadeAction(stackAnimations[0])
    // console.log(animations[target.innerText])
  })

  var recognition = null

  if (!('webkitSpeechRecognition' in window)) {
    upgrade()
  } else {
    recognition = new webkitSpeechRecognition()
    recognition.continuous = false
    recognition.interimResults = false

    recognition.onstart = function () {
      // console.log("onstart")
    }
    recognition.onresult = function (event) {
      // console.log("onresult")
      let message = event.results[0][0].transcript

      document.getElementById("icon-result-speech").style.visibility = 'visible'
      document.getElementById('message').innerText = message
      let actionNames = processTranscript(message)
      stackAnimations = actionNames
      console.log('animation stack', stackAnimations)
      if (stackAnimations.length > 0) {
        fadeAction(stackAnimations[0])
      }

    }
    recognition.onerror = function (event) {
      console.log("onerror")
      console.log(event)

    }
    recognition.onend = function () {
      // console.log("onend")
    }

    function startSpeak (event) {
      // console.log("onmousedown")
      final_transcript = ''
      if (recognition != null) {
        recognition.lang = 'es-PE'
        recognition.start()
      } else {
        console.log('recognition is null')
      }
    }

    function stopSpeak (event) {
      // console.log("onmouseup")
      recognition.stop()
    }

  }
  function upgrade () {
    document.getElementById('info_upgrade').style.visibility = 'visible'
  }

  function processTranscript(transcript) {
    let words = transcript.split(" ")
    let keywords = words.filter(function (word) {
      return (animations[capitalizeFirstLetter(word)] !== undefined)
    }).map(function (item) {
      return animations[capitalizeFirstLetter(item)]
    })
    return keywords
  }
</script>
<script>
    document.getElementById('input-text').addEventListener('change', function (ev) {
      console.log(ev)
    })
</script>
</body>
</html>
